---
name: Install Bicep
description: Install Bicep and Add to the Path

runs:
  using: "composite"
  steps:
    - name: Install Bicep
      run: |
        $TOOLS_PATH = "./tools"
        $installDir = Join-Path -Path $TOOLS_PATH -ChildPath "bicep"

        $toolFileName = "bicep"
        $toolFilePath = Join-Path -Path $installDir -ChildPath $toolFileName
        
        if(!(Test-Path $installDir)) {
          New-Item -ItemType Directory -Path $installDir | Out-String | Write-Verbose
        }

        $url = "https://github.com/Azure/bicep/releases/latest/download/bicep-linux-x64"

        Invoke-WebRequest -Uri $url -OutFile "$toolFilePath" | Out-String | Write-Verbose

        $isExecutable = $(test -x $toolFilePath; 0 -eq $LASTEXITCODE)
          if(!($isExecutable)) {
            chmod +x $toolFilePath
        }

        echo "$installDir" >> $GITHUB_PATH

        bicep --help

        Write-Host "Installed Latest Bicep Version"
      shell: pwsh
